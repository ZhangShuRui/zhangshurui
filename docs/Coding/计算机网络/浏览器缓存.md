
## 缓存概念

缓存的原理是在首次请求后保存一份请求资源的响应副本，当用户再次发起相同请求后，如果判断缓存命中则拦截请求，将之前存储的响应副本返回给用户，从而避免重新向服务器发起资源请求。

缓存的技术种类有很多，比如代理缓存、浏览器缓存、网关缓存、负载均衡器及内容分发网络等，它们大致可以分为两类：共享缓存和私有缓存。

共享缓存指的是缓存内容可被多个用户使用，如公司内部架设的Web代理；私有缓存指的是只能单独被用户使用的缓存，如浏览器缓存。 

## 浏览器缓存（前端开发相关）

### 流程

![[00 Attachment/Pasted image 20230813170148.png]]

### 浏览器缓存方式：

![[00 Attachment/Pasted image 20230813170241.png]]

## 强制缓存

`Expires` 的单位是分钟，这样会有一个问题，就是如果资源在1分钟内变更，无法去更新
现在更多的是使用 **`Cahce-Control`** 字段，单位是秒

![[00 Attachment/Pasted image 20230813170620.png]]

例子

![[00 Attachment/Pasted image 20230813170808.png]]

31536000 / 3600 /24 = 365 (1年)

## 协商缓存

两种方案: 
- Last-Modify/If-Modify-Since
- etag/if-none-match (hash)

![[00 Attachment/Pasted image 20230813170950.png]]
### 协商缓存的问题及解决方案

Last-Modify 是自愿最后修改的时间（秒），在1秒内资源改变依旧会存在Bug;

这边使用一个新的技术，`etag` ，本质就是一个hash值，请求资源前先比对hash值，如果相同，说明资源没有被改变，服务器返回304，让浏览器去缓存中取;

但是生成hash值是需要耗费服务器的资源的，越是大文件，计算负担越大，所以也有缺点。

**注意：** 协商缓存也是需要向服务器发送请求的，etag 和 last-modify 。Expires或者Cache-Control的max-age没有过期的话，就是强制缓存，强制缓存比协商缓存的优先级高。
## 禁止浏览器缓存

![[00 Attachment/Pasted image 20230813171233.png]]

# [如何控制强缓存​](https://www.1024nav.com/front-junior/browser-basic#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E5%BC%BA%E7%BC%93%E5%AD%98 "")

强缓存的控制请求头和响应头分别有

- Expires 和 Last-Modified
- Cache-Control

两者都存在的情况下，Cache-Control的优先级更高

# [如何控制协商缓存​](https://www.1024nav.com/front-junior/browser-basic#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98 "")

协商缓存的控制请求头和响应头分别有

- Last-Modify 和 If-Modify-Since
- Etag 和 If-None-Match

两者都存在的情况下，ETag的优先级更高

# 关联文章

[掘金：彻底理解浏览器的缓存机制](https://juejin.cn/post/6844903593275817998)

https://www.1024nav.com/front-junior/browser-basic