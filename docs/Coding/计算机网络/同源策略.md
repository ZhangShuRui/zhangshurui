# 定义

同源策略（Same-Origin Policy）是一种安全机制，它是浏览器中的一个重要概念，用于限制不同源（Origin）之间的网页间交互，以保护用户的隐私和安全。源（Origin）指的是由协议、主机和端口组成的一个网站标识符，只有在同一个源内的网页才能够相互访问彼此的数据和功能。 ^9e4f1b

同源策略的原则是：页面A中的JavaScript代码只能够访问与页面A具有相同源的页面B中的数据和功能，而不能直接访问不同源的页面C中的数据和功能。

举例说明：

1. **相同源示例**：
   - 源1：https://www.example.com
   - 源2：https://www.example.com
   这两个页面具有相同的协议、主机和端口，因此它们属于相同的源。在这种情况下，页面A可以通过JavaScript代码访问页面B的数据和功能，因为它们遵循了同源策略。

2. **不同源示例**：
   - 源1：https://www.example.com
   - 源2：https://www.different-site.com
   这两个页面属于不同的源，因为它们的主机部分不同。如果页面A的JavaScript代码试图直接访问页面C的数据，浏览器会阻止这样的操作，因为这违反了同源策略。

# 非同源（不同源）限制

1. **DOM访问限制**：
   JavaScript代码在一个源中执行时，无法直接访问其他源的DOM元素，这包括通过getElementById、querySelector等方法获取的元素。尝试从一个源的页面中访问另一个源的DOM会被浏览器拒绝。

2. **Cookie、LocalStorage和SessionStorage访问限制**：
   Cookie、LocalStorage和SessionStorage等存储机制的数据在一个源中存储，其他源无法直接访问这些数据。这确保了敏感信息不会被其他源恶意获取。

3. **AJAX和Fetch请求受限**：
   在非同源的情况下，通过AJAX或Fetch API发送HTTP请求会受到限制。同源策略会阻止跨域请求的发送。浏览器会发送一个预检请求（OPTIONS请求）以确认服务器是否允许跨域请求。

4. **嵌入的资源限制**：
   如果一个页面想要在自己的页面中嵌入来自其他源的资源，如图片、脚本、样式表等，浏览器可能会限制这些资源的加载，除非服务器允许跨域资源共享（CORS）。

5. **iframe通信限制**：
   嵌入在一个页面中的iframe中的内容与父页面之间的通信受到限制。非同源的iframe无法直接通过JavaScript与父页面进行交互。

6. **无法共享部分协议信息**：
   即使两个页面具有相同的主机和端口，如果它们的协议不同（例如一个是https，另一个是http），同源策略也会阻止它们之间的交互。

这些限制有助于防止恶意网站利用跨域请求来窃取用户信息或执行恶意操作。同时，为了在需要的情况下实现跨域资源共享，开发者可以使用CORS等方法来解决跨域问题，从而平衡了安全和可用性。

# 解决跨域方案
     
解决跨域问题的方法有几种，开发者可以根据具体情况选择适合自己应用的方案。以下是一些常见的跨域解决方案：

1. **CORS（跨域资源共享）**：[[03 Coding/计算机网络/CORS跨域资源共享|CORS跨域资源共享]]
   CORS是一种由服务器决定是否允许跨域请求的机制。服务器可以在HTTP响应头中添加特定的CORS头，指定允许访问的源、方法和头信息。当浏览器发起跨域请求时，会先发送一个预检请求（OPTIONS请求）到服务器，服务器根据预检请求的头信息判断是否允许跨域访问。

2. **JSONP（JSON with Padding）**：
   JSONP是一种利用script标签不受同源策略限制的特点，通过动态创建script元素来加载一个包含回调函数调用的远程脚本。服务器返回的脚本会在本地执行，并将数据传递给预先定义好的回调函数。

3. **代理服务器**：
   使用代理服务器作为中间人来实现跨域请求。前端应用发送请求给同源的代理服务器，然后由代理服务器将请求转发给目标服务器，最后再将响应返回给前端应用。这种方式不会触发同源策略，因为浏览器认为请求是从同源的服务器发出的。

4. **WebSocket协议**：
   WebSocket协议允许在不同源之间建立双向通信的连接。因为WebSocket连接的建立不受同源策略的限制，可以在不同源之间进行实时通信。

5. **跨文档消息通信（Window.postMessage）**：
   使用Window.postMessage方法可以在不同源的窗口之间安全地传递消息。这在嵌套的iframe或弹出窗口之间进行通信时非常有用。

6. **服务端代理**：
   在服务器端设置代理，使服务器来请求目标资源，然后将响应返回给客户端。这样，客户端就不需要直接与目标服务器进行跨域通信。

无论使用哪种方法，都应该在确保安全性的前提下进行跨域操作。在实施跨域解决方案时，应该考虑服务器配置、安全性、性能和可维护性等因素。
