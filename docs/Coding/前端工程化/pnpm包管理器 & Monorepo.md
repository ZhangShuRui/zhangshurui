## pnpm

- 速度快
- 磁盘占用少（软硬链接）
- 项目依赖彼此对、隔离
- 有各种命令方便操作

## monorepo

### 定义

在一个代码仓库中，管理多个不同的项目。

举个例子：
- webpack及其插件；
- 同时包含前后端的大型项目；
- Chrome扩展等有多个入口的项目；

monorepo优势：
- 便于管理多个互相依赖的项目；
- 便于团队共享知识库；
- 减少项目管理成本；

monorepo劣势：
- 版本管理混乱；
- 代码质量参差不齐，且相互影响；
- 技术栈升级困难；
- 难以进行对仓库权限管理；

### 什么时候使用Monorepo?

充分条件：
- 多个项目互相依赖；
- 功能、版本之间存在强关联；
- 项目存在多个编译入口，且构建条件存在差异；

- 次要条件
- 希望在团队中共享知识；
- 降低项目的管理成本；


### 实操

参看文档：https://pnpm.io/zh/workspaces

#### 创建 pnpm-workspace.yaml

```yaml

packages:
- 'packages/*'
- 'apps/*'
- 'api'
```

含义解释： `packages`  `apps` 下所有的文件夹都是单独的项目，`api` 自己是一个单独的项目。

#### 在这个仓库中互相引用包

比如下面的例子，在 `popup` 包中去引用 `core` 包

![[../../00 Attachment/Pasted image 20230607142818.png]]

另一个例子：`app` 去依赖 `packages/editor`  
![[../../00 Attachment/Pasted image 20230607143035.png]]

#### 安装依赖

推荐：在仓库的根目录，再进入项目的根目录下，执行 `pnpm install` ；（心智负担最低）


### 常见问题的解决

#### 基本原则：各司其职
- pnpm 只负责生成依赖的目录 `node_modules`
- 脚手架负责在工作目录内构建开发环境、打包项目
- lock 文件负责记录依赖版本号
- `package.json`负责记录依赖和脚本

#### 问题
- 需要给每个项目文件夹配置单独的入口文件吗？
是的，需要。每个项目文件夹都是独立的项目，并不知道其他项目的存在。

- 怎么安装依赖？
建议在每个项目文件夹下执行 `pnpm i` 。

- 怎么引用依赖？
该怎么引用就怎么引用。

- 怎么打包？怎么启动开发环境？
对每个项目而言，和以前一样。对于整个项目，可以自己写脚本。

- 单个项目需要发布到NPM吗？
不需要，对于同一个Monorepo下的项目，他们相当于已经发布了。

- 怎么处理端口？
以前怎么处理，现在还是。workspace不会帮你处理端口。

